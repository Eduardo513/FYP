const fetch = require('node-fetch');
const { version } = require('../package.json');
const PUBGProfile = require('./Profile');

class PUBGClient {
	constructor(apikey) {
		if (!apikey) throw new Error('No api key entered.');

		this.apikey = apikey;
		this._userAgent = `pubg-stats v${version} (https://github.com/iCrawl/pubg-stats)`;
		this.options = {
			headers: {
				'User-Agent': this._userAgent,
				'TRN-Api-Key': this.apikey
			}
		};
	}

	getProfile(username) {
		return new Promise((resolve, reject) => {
			const searchTerm = encodeURIComponent(username.toLowerCase());
			return fetch(`https://pubgtracker.com/api/profile/pc/${searchTerm}`, this.options)
				.then(res => res.json())
				.then(json => resolve(new PUBGProfile(json)))
				.catch(err => reject(err));
		});
	}
}

module.exports = PUBGClient;
